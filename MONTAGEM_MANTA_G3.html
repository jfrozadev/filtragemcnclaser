<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Montagem â€” Manta G3 + Clips Snap-fit</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#1a1a2e;overflow:hidden}
#c{width:100vw;height:100vh;display:block}
#panel{position:absolute;top:10px;left:10px;background:rgba(255,255,255,.97);padding:14px;border-radius:10px;max-width:320px;box-shadow:0 8px 30px rgba(0,0,0,.4);max-height:calc(100vh - 20px);overflow-y:auto}
h1{font-size:.95rem;color:#2c3e50;margin-bottom:2px}
.sub{font-size:.6rem;color:#7f8c8d;margin-bottom:8px}
.step{background:#f0f7ff;padding:10px;border-radius:8px;margin-bottom:8px;border-left:3px solid #3498db}
.step h2{font-size:.78rem;color:#2c3e50;margin-bottom:3px}
.step p{font-size:.65rem;color:#555;line-height:1.35}
.nav{display:flex;gap:6px;margin-bottom:8px}
.nav button{flex:1;padding:7px;border:none;border-radius:6px;font-size:.72rem;font-weight:600;cursor:pointer;transition:.15s}
.bp{background:#ecf0f1;color:#2c3e50}.bp:hover{background:#d5dbdb}
.bn{background:#3498db;color:#fff}.bn:hover{background:#2980b9}
.sec{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:8px;margin-bottom:8px}
.sec h3{font-size:.68rem;color:#495057;margin-bottom:4px}
.sec pre{font-size:.58rem;line-height:1.3;color:#333;font-family:'Cascadia Code','Consolas',monospace}
.specs{font-size:.6rem;color:#666;margin-bottom:6px}
.specs table{width:100%;border-collapse:collapse}
.specs td{padding:1px 4px}.specs .l{color:#888}.specs .v{font-weight:600;text-align:right}
.legend{display:flex;gap:8px;flex-wrap:wrap}
.legend span{display:flex;align-items:center;gap:3px;font-size:.58rem}
.legend i{width:10px;height:10px;border-radius:2px;display:inline-block}
#info{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,.85);padding:5px 14px;border-radius:6px;font-size:.62rem;white-space:nowrap}
</style>
</head>
<body>
<div id="c"></div>
<div id="panel">
  <h1>ğŸ”§ Montagem â€” Manta G3</h1>
  <div class="sub">DivisÃ³ria 244Ã—240mm Â· Furo 200Ã—200mm Â· 8 clips snap-fit</div>
  <div class="step"><h2 id="sT"></h2><p id="sD"></p></div>
  <div class="nav">
    <button class="bp" onclick="prev()">â† Anterior</button>
    <button class="bn" onclick="next()">PrÃ³ximo â†’</button>
  </div>
  <div class="sec">
    <h3>SeÃ§Ã£o transversal do clip</h3>
    <pre>
        â”Œâ”€â”€â”€ aba 15mm â”€â”€â”€â”
        â”‚   MANTA 10mm   â”‚
  â•â•â•â•â•â•â•ªâ•â•â•â• MDF 3mm â•â•â•â•ªâ•â•â•â•â•â•
        â”‚   base 8mm     â”‚
        â””â”€â”¤denteâ”œâ”€â”€â”€â”¤denteâ”œâ”€â”˜
    </pre>
  </div>
  <div class="specs"><table>
    <tr><td class="l">Filtro:</td><td class="v">Manta G3 â€” 200Ã—200Ã—10mm</td></tr>
    <tr><td class="l">Furo MDF:</td><td class="v">200Ã—200mm centralizado</td></tr>
    <tr><td class="l">Clips:</td><td class="v">8Ã— (larg 30mm, aba 15mm)</td></tr>
    <tr><td class="l">Slots CNC:</td><td class="v">16Ã— (10Ã—2mm, a 8mm do furo)</td></tr>
  </table></div>
  <div class="legend">
    <span><i style="background:#CD853F"></i>MDF</span>
    <span><i style="background:#2ecc71"></i>Manta</span>
    <span><i style="background:#e67e22"></i>Clip</span>
    <span><i style="background:#c0392b"></i>Dentes</span>
    <span><i style="background:#222"></i>Slots</span>
  </div>
</div>
<div id="info">ğŸ–±ï¸ Arrastar = Girar Â· Scroll = Zoom Â· â† â†’ = Passos</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
/* ===== DADOS EXTRAÃDOS DOS ARQUIVOS NC E SCAD ===== */
// Escala: 1 unidade = 100mm

// MDF 244Ã—240Ã—3mm
const W = 2.44, H = 2.40, T = 0.03;

// Furo 200Ã—200mm (X: 22-222, Y: 20-220)
const HOLE_X1 = 0.22, HOLE_X2 = 2.22;  // em unidades
const HOLE_Z1 = 0.20, HOLE_Z2 = 2.20;  // Y do NC â†’ Z no 3D
const HOLE_W = HOLE_X2 - HOLE_X1;      // 2.00
const HOLE_H = HOLE_Z2 - HOLE_Z1;      // 2.00

// Filtro Manta G3 200Ã—200Ã—10mm
const FILT_W = 2.00, FILT_H = 2.00, FILT_T = 0.10;

// Clip (CLIP_MANTA_G3.scad)
const CLIP_LARG = 0.30;    // 30mm
const CLIP_PAREDE = 0.02;  // 2mm
const ABA_COMP = 0.15;     // 15mm
const ABA_ESP = 0.015;     // 1.5mm
const BASE_PROF = 0.08;    // 8mm
const DENTE_POS = 0.07;    // 7mm do centro

// PosiÃ§Ãµes dos 8 clips (NC: clips em X=72,152 e Y=80,160)
const CLIPS = [
  // Inferior (Y=20 no NC â†’ Z=0.20): 2 clips em X=72 e X=152
  { x: 0.72, z: HOLE_Z1, rot: Math.PI },      // aponta -Z (para baixo)
  { x: 1.52, z: HOLE_Z1, rot: Math.PI },
  // Superior (Y=220 no NC â†’ Z=2.20): 2 clips em X=72 e X=152
  { x: 0.72, z: HOLE_Z2, rot: 0 },            // aponta +Z (para cima)
  { x: 1.52, z: HOLE_Z2, rot: 0 },
  // Esquerdo (X=22 â†’ X=0.22): 2 clips em Y=80 e Y=160
  { x: HOLE_X1, z: 0.80, rot: -Math.PI/2 },   // aponta -X (para esquerda)
  { x: HOLE_X1, z: 1.60, rot: -Math.PI/2 },
  // Direito (X=222 â†’ X=2.22): 2 clips em Y=80 e Y=160
  { x: HOLE_X2, z: 0.80, rot: Math.PI/2 },    // aponta +X (para direita)
  { x: HOLE_X2, z: 1.60, rot: Math.PI/2 }
];

// Slots 16Ã— (10Ã—2mm) - centros aproximados
const SLOTS_H = [  // Horizontais (10mm larg Ã— 2mm prof)
  [0.65, 0.11], [0.79, 0.11], [1.45, 0.11], [1.59, 0.11],  // inferior
  [0.65, 2.29], [0.79, 2.29], [1.45, 2.29], [1.59, 2.29]   // superior
];
const SLOTS_V = [  // Verticais (2mm larg Ã— 10mm prof)
  [0.13, 0.73], [0.13, 0.87], [0.13, 1.53], [0.13, 1.67],  // esquerdo
  [2.31, 0.73], [2.31, 0.87], [2.31, 1.53], [2.31, 1.67]   // direito
];

/* ===== ETAPAS ===== */
const STEPS = [
  { title: "Etapa 1/4 â€” DivisÃ³ria MDF",
    desc: "Placa MDF 244Ã—240Ã—3mm cortada CNC. Furo central 200Ã—200mm. 16 slots para os dentes dos clips.",
    show: { mdf: true, slots: true, filter: false, clips: false } },
  { title: "Etapa 2/4 â€” Posicionar Manta G3",
    desc: "Coloque a manta G3 (200Ã—200Ã—10mm) sobre o furo. A manta cobre o furo inteiro.",
    show: { mdf: true, slots: true, filter: true, clips: false } },
  { title: "Etapa 3/4 â€” Encaixar os 8 Clips",
    desc: "Encaixe cada clip: base por baixo do MDF, dentes nos slots, aba prensa a manta.",
    show: { mdf: true, slots: true, filter: true, clips: true } },
  { title: "Etapa 4/4 â€” Montagem Completa",
    desc: "âœ… Manta fixada! Para trocar: pressione os dentes, retire clips, troque a manta.",
    show: { mdf: true, slots: true, filter: true, clips: true } }
];

let step = 0;
let scene, camera, renderer;
let groups = {};
let isDragging = false, prevMouse = { x: 0, y: 0 };
let spherical = { phi: 0.8, theta: 0.6, radius: 4.5 };

function init() {
  // Cena
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x263238);
  
  // CÃ¢mera
  camera = new THREE.PerspectiveCamera(40, innerWidth / innerHeight, 0.1, 100);
  
  // Renderer
  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
  renderer.setSize(innerWidth, innerHeight);
  document.getElementById('c').appendChild(renderer.domElement);
  
  // Luzes
  scene.add(new THREE.AmbientLight(0xffffff, 0.5));
  const dl1 = new THREE.DirectionalLight(0xffffff, 0.7);
  dl1.position.set(5, 8, 6);
  scene.add(dl1);
  const dl2 = new THREE.DirectionalLight(0xffffff, 0.3);
  dl2.position.set(-4, 4, -5);
  scene.add(dl2);
  
  // Grid
  const grid = new THREE.GridHelper(6, 12, 0x546e7a, 0x37474f);
  grid.position.y = -T - 0.02;
  scene.add(grid);
  
  // Construir elementos
  buildMDF();
  buildSlots();
  buildFilter();
  buildClips();
  
  // Mostrar etapa
  showStep();
  
  // Controles
  setupControls();
  window.addEventListener('resize', onResize);
  
  // Animar
  animate();
}

function buildMDF() {
  const mat = new THREE.MeshPhongMaterial({ color: 0xCD853F, transparent: true, opacity: 0.9 });
  const g = new THREE.Group();
  
  // MDF como 4 bordas ao redor do furo
  const bLeft = HOLE_X1;
  const bRight = W - HOLE_X2;
  const bBottom = HOLE_Z1;
  const bTop = H - HOLE_Z2;
  
  // Borda inferior
  g.add(box(W, T, bBottom, mat)).position.set(W/2, -T/2, bBottom/2);
  // Borda superior
  g.add(box(W, T, bTop, mat)).position.set(W/2, -T/2, H - bTop/2);
  // Borda esquerda
  g.add(box(bLeft, T, HOLE_H, mat)).position.set(bLeft/2, -T/2, H/2);
  // Borda direita
  g.add(box(bRight, T, HOLE_H, mat)).position.set(W - bRight/2, -T/2, H/2);
  
  scene.add(g);
  groups.mdf = g;
}

function buildSlots() {
  const mat = new THREE.MeshPhongMaterial({ color: 0x1a1a1a });
  const g = new THREE.Group();
  
  SLOTS_H.forEach(([x, z]) => {
    g.add(box(0.10, T + 0.002, 0.02, mat)).position.set(x, -T/2, z);
  });
  SLOTS_V.forEach(([x, z]) => {
    g.add(box(0.02, T + 0.002, 0.10, mat)).position.set(x, -T/2, z);
  });
  
  scene.add(g);
  groups.slots = g;
}

function buildFilter() {
  const mat = new THREE.MeshPhongMaterial({ color: 0x2ecc71, transparent: true, opacity: 0.5 });
  const mesh = box(FILT_W, FILT_T, FILT_H, mat);
  mesh.position.set(W/2, FILT_T/2, H/2);
  scene.add(mesh);
  groups.filter = mesh;
}

function buildClips() {
  const g = new THREE.Group();
  
  CLIPS.forEach(c => {
    const clip = makeClip();
    clip.position.set(c.x, 0, c.z);
    clip.rotation.y = c.rot;
    g.add(clip);
  });
  
  scene.add(g);
  groups.clips = g;
}

function makeClip() {
  const g = new THREE.Group();
  const mat = new THREE.MeshPhongMaterial({ color: 0xe67e22 });
  const dmat = new THREE.MeshPhongMaterial({ color: 0xc0392b });
  
  // Geometria do clip conforme SCAD:
  // - PAREDE: vertical na borda do furo (Y local = 0)
  // - BASE: abaixo do MDF, estende -Y local (vira +Z apÃ³s rot de clips inf/sup)
  // - ABA: acima do filtro, estende -Y local (mesma direÃ§Ã£o da base)
  // 
  // ConvenÃ§Ã£o local (antes da rotaÃ§Ã£o):
  // X = largura do clip (paralelo Ã  borda)
  // Y = profundidade (base/aba estendem em -Y = para fora do furo)
  // Z = altura (vertical)
  
  // Parede vertical (na borda do furo)
  const wallH = T + FILT_T + ABA_ESP + 0.01;
  g.add(box(CLIP_LARG, CLIP_PAREDE, wallH, mat)).position.set(0, -CLIP_PAREDE/2, FILT_T/2 - T/2);
  
  // Base (abaixo do MDF, estende -Y)
  g.add(box(CLIP_LARG, BASE_PROF, CLIP_PAREDE, mat)).position.set(0, -BASE_PROF/2, -T - CLIP_PAREDE/2);
  
  // Aba (acima do filtro, estende -Y)
  g.add(box(CLIP_LARG, ABA_COMP, ABA_ESP, mat)).position.set(0, -ABA_COMP/2, FILT_T + ABA_ESP/2);
  
  // 2 Dentes (na ponta da base)
  for (let d of [-1, 1]) {
    const tooth = box(0.08, 0.02, 0.012, dmat);
    tooth.position.set(d * DENTE_POS, -BASE_PROF + 0.01, -T + 0.006);
    g.add(tooth);
  }
  
  return g;
}

function box(w, h, d, mat) {
  return new THREE.Mesh(new THREE.BoxGeometry(w, h, d), mat);
}

function showStep() {
  const s = STEPS[step];
  document.getElementById('sT').textContent = s.title;
  document.getElementById('sD').textContent = s.desc;
  
  groups.mdf.visible = s.show.mdf;
  groups.slots.visible = s.show.slots;
  groups.filter.visible = s.show.filter;
  groups.clips.visible = s.show.clips;
  
  // Reset posiÃ§Ãµes
  groups.filter.position.y = FILT_T / 2;
  groups.clips.children.forEach(c => c.position.y = 0);
  
  // AnimaÃ§Ãµes
  if (step === 1) animateFilter();
  if (step === 2) animateClips();
}

function animateFilter() {
  groups.filter.position.y = 0.4;
  function tick() {
    if (step !== 1) return;
    if (groups.filter.position.y > FILT_T/2 + 0.002) {
      groups.filter.position.y -= 0.005;
      requestAnimationFrame(tick);
    } else {
      groups.filter.position.y = FILT_T / 2;
    }
  }
  tick();
}

function animateClips() {
  const clips = groups.clips.children;
  clips.forEach((c, i) => c.position.y = 0.35 + i * 0.02);
  let t = 0;
  function tick() {
    if (step !== 2) { clips.forEach(c => c.position.y = 0); return; }
    t += 0.02;
    let allDone = true;
    clips.forEach((c, i) => {
      const delay = i * 0.1;
      const progress = Math.min(1, Math.max(0, (t - delay) * 2));
      c.position.y = 0.35 * (1 - progress * progress * progress);
      if (progress < 1) allDone = false;
    });
    if (!allDone) requestAnimationFrame(tick);
    else clips.forEach(c => c.position.y = 0);
  }
  tick();
}

function next() { if (step < STEPS.length - 1) { step++; showStep(); } }
function prev() { if (step > 0) { step--; showStep(); } }

function setupControls() {
  const el = renderer.domElement;
  el.addEventListener('pointerdown', e => {
    isDragging = true;
    prevMouse = { x: e.clientX, y: e.clientY };
    el.setPointerCapture(e.pointerId);
  });
  el.addEventListener('pointermove', e => {
    if (!isDragging) return;
    spherical.phi -= (e.clientX - prevMouse.x) * 0.005;
    spherical.theta = Math.max(0.1, Math.min(1.5, spherical.theta - (e.clientY - prevMouse.y) * 0.005));
    prevMouse = { x: e.clientX, y: e.clientY };
  });
  el.addEventListener('pointerup', () => isDragging = false);
  el.addEventListener('wheel', e => {
    spherical.radius = Math.max(2, Math.min(10, spherical.radius + e.deltaY * 0.003));
  }, { passive: true });
  document.addEventListener('keydown', e => {
    if (e.key === 'ArrowRight') next();
    if (e.key === 'ArrowLeft') prev();
  });
}

function onResize() {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
}

function animate() {
  requestAnimationFrame(animate);
  
  const cx = W / 2, cz = H / 2;
  camera.position.set(
    cx + spherical.radius * Math.sin(spherical.phi) * Math.cos(spherical.theta),
    spherical.radius * Math.sin(spherical.theta),
    cz + spherical.radius * Math.cos(spherical.phi) * Math.cos(spherical.theta)
  );
  camera.lookAt(cx, 0.05, cz);
  
  renderer.render(scene, camera);
}

init();
</script>
</body>
</html>
